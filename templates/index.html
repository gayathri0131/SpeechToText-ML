<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Speech To Text</title>
<style>
    body {
        font-family: Arial, sans-serif; background: #f2f2f2;
        text-align: center; padding: 30px;
    }
    .container {
        display: flex; justify-content: center; gap: 80px;
        margin-top: 40px;
    }
    .card {
        width: 260px; background: #fff; padding: 20px;
        border-radius: 10px; box-shadow: 0 0 8px #ccc;
    }
    button {
        padding: 10px 20px; border: none; cursor: pointer;
        border-radius: 8px; background: #007bff; color: #fff;
        font-size: 16px;
    }
    #output {
        margin-top: 50px; width: 80%; height: 200px;
        padding: 20px; font-size: 18px;
        border: 2px solid #007bff; border-radius: 10px;
        background: #fff; text-align: left;
    }
</style>
</head>
<body>

<h2>Speech To Text Converter </h2>

<div class="container">

    <!-- File to Text -->
    <div class="card">
        <h3>Upload Audio File</h3>
        <input type="file" id="audioFile"><br><br>
        <p id="fileName"></p>
        <button onclick="convertFile()">Convert</button>
    </div>

    <!-- Microphone Input -->
    <div class="card">
        <h3>Microphone</h3>
        <button onclick="toggleMic()"> Start Listening</button>
    </div>

</div>

<!-- Shared Output Box -->
<textarea id="output" placeholder="Text will appear here..." readonly></textarea>

<script>
let recognition;
if ("webkitSpeechRecognition" in window) {
    recognition = new webkitSpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;

    recognition.onresult = (event) => {
        let text = "";
        for (let i = 0; i < event.results.length; i++) {
            text += event.results[i][0].transcript;
        }
        document.getElementById("output").value = text;
    };
} else {
    alert("Speech Recognition not supported in this browser.");
}

function toggleMic() {
    recognition.start();
}

// Choose File Label
document.getElementById("audioFile").addEventListener("change", function () {
    document.getElementById("fileName").innerText = "Selected: " + this.files[0].name;
});

// Convert File Button
function convertFile() {
    let file = document.getElementById("audioFile").files[0];
    if (!file) return alert("Please select a file!");

    let formData = new FormData();
    formData.append("audio_file", file);

    fetch("/convert", {
        method: "POST",
        body: formData,
    })
        .then((res) => res.json())
        .then((data) => {
            if (data.text) {
                document.getElementById("output").value = data.text;
            }
        });
}
</script>

</body>
</html>
